{% extends "base.html" %}

{% block content %}
<div id="dashboard-view" class="h-full flex flex-col animate-fade-in">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
    <div>
      <h1 class="text-2xl font-bold mb-1">ä»ªè¡¨ç›˜</h1>
      <p class="text-secondary opacity-70">ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ä¸ä»»åŠ¡ç›‘æ§</p>
    </div>

    <div class="flex flex-wrap gap-4 items-center">
      <!-- Speed Cards -->
      <div class="flex gap-4">
        <div class="stat-card">
          <div class="stat-icon-wrapper accent">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
          </div>
          <div class="flex flex-col">
            <span class="text-xs text-secondary uppercase tracking-wider font-bold">ä¸‹è½½é€Ÿåº¦</span>
            <span class="font-mono text-xl text-text font-bold" id="global-speed">0.00 B/s</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon-wrapper success">
            <svg class="icon" viewBox="0 0 24 24">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
          </div>
          <div class="flex flex-col">
            <span class="text-xs text-secondary uppercase tracking-wider font-bold">ä¸Šä¼ é€Ÿåº¦</span>
            <span class="font-mono text-xl text-text font-bold" id="global-upload-speed">0.00 B/s</span>
          </div>
        </div>
      </div>

      <!-- Global Control -->
      {% set state_str = download_state|string %}
      {% set is_running = 'Downloading' in state_str %}
      <button id="state-toggle-btn"
        class="btn {{ 'btn-danger' if is_running else 'btn-primary' }} px-6 py-3 h-auto font-medium shadow-lg hover:shadow-xl transition-all">
        <span class="flex items-center gap-2">
          <svg class="icon" viewBox="0 0 24 24" style="width:18px;height:18px;">
            {% if is_running %}
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
            {% else %}
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
            {% endif %}
          </svg>
          {{ 'æš‚åœæ‰€æœ‰' if is_running else 'å¼€å§‹æ‰€æœ‰' }}
        </span>
      </button>
    </div>
  </div>

  <!-- Tabs Navigation & Filters -->
  <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
    <!-- Left: Segmented Tabs -->
    <div class="inline-flex p-1 glass-container rounded-xl">
      <button class="tab-btn active px-6 py-2.5 rounded-lg text-sm font-medium" onclick="switchTab('active')">
        <div class="tab-btn-bg"></div>
        <div class="tab-btn-border"></div>
        <span
          class="relative z-10 flex items-center gap-2 group-[.active]:text-accent text-secondary group-hover:text-text transition-colors">
          ä¸‹è½½ä¸­
          <span id="active-count" class="badge-soft badge-accent-soft">0</span>
        </span>
      </button>

      <button class="tab-btn px-6 py-2.5 rounded-lg text-sm font-medium" data-theme="success"
        onclick="switchTab('upload')">
        <div class="tab-btn-bg"></div>
        <div class="tab-btn-border"></div>
        <span
          class="relative z-10 flex items-center gap-2 group-[.active]:text-success text-secondary group-hover:text-text transition-colors">
          ä¸Šä¼ ä¸­
          <span id="upload-count" class="badge-soft badge-success-soft">0</span>
        </span>
      </button>

      <button class="tab-btn px-6 py-2.5 rounded-lg text-sm font-medium" data-theme="neutral"
        onclick="switchTab('history')">
        <div class="tab-btn-bg"></div>
        <div class="tab-btn-border"></div>
        <span
          class="relative z-10 flex items-center gap-2 group-[.active]:text-text text-secondary group-hover:text-text transition-colors">
          å·²å®Œæˆ
          <span id="history-count" class="badge-soft badge-secondary-soft">0</span>
        </span>
      </button>
    </div>

    <!-- Right: Filters -->
    <div id="filter-toolbar"
      class="flex items-center gap-1 p-1 bg-surface/50 rounded-lg border border-transparent hover:border-border transition-colors">
      <button class="filter-chip active px-4 py-1.5 rounded-md" onclick="filterType('all')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">å…¨éƒ¨</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('video')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸ¬ è§†é¢‘</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('image')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ï¿½ï¸ å›¾ç‰‡</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('audio')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸµ éŸ³é¢‘</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('other')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸ“„ å…¶ä»–</span>
      </button>
    </div>
  </div>

  <!-- Task Lists Container -->
  <div class="flex-1 overflow-hidden relative rounded-xl border border-border shadow-lg bg-card/50 backdrop-blur-sm">

    <!-- Active Tasks Tab (Downloading) -->
    <div id="tab-active" class="tab-content h-full flex flex-col">
      <div class="table-container flex-1 overflow-auto">
        <table class="table w-full relative">
          <thead
            class="sticky top-0 bg-surface z-10 shadow-sm text-xs uppercase tracking-wider text-secondary font-semibold">
            <tr>
              <th width="60" class="text-center">ç±»å‹</th>
              <th width="80">æ¥æºID</th>
              <th width="40%">æ–‡ä»¶å</th>
              <th width="120">ä¸Šä¼ çŠ¶æ€</th>
              <th width="100">å¤§å°</th>
              <th>ä¸‹è½½è¿›åº¦</th>
              <th width="120" class="text-right">å½“å‰é€Ÿåº¦</th>
            </tr>
          </thead>
          <tbody id="downloading-tbody">
            <!-- JS Populated -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Uploading Tasks Tab -->
    <div id="tab-upload" class="tab-content hidden h-full flex flex-col">
      <div class="table-container flex-1 overflow-auto">
        <table class="table w-full relative">
          <thead
            class="sticky top-0 bg-surface z-10 shadow-sm text-xs uppercase tracking-wider text-secondary font-semibold">
            <tr>
              <th width="60" class="text-center">ç±»å‹</th>
              <th width="80">æ¥æºID</th>
              <th width="40%">æ–‡ä»¶å</th>
              <th width="120">çŠ¶æ€</th>
              <th width="100">å¤§å°</th>
              <th>ä¸Šä¼ è¿›åº¦</th>
              <th width="120" class="text-right">å½“å‰é€Ÿåº¦</th>
            </tr>
          </thead>
          <tbody id="uploading-tbody">
            <!-- JS Populated -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- History Tab -->
    <div id="tab-history" class="tab-content hidden h-full flex flex-col">
      <div class="table-container flex-1 overflow-auto">
        <table class="table w-full relative">
          <thead
            class="sticky top-0 bg-surface z-10 shadow-sm text-xs uppercase tracking-wider text-secondary font-semibold">
            <tr>
              <th width="60" class="text-center">ç±»å‹</th>
              <th width="80">ID</th>
              <th width="40%">æ–‡ä»¶å</th>
              <th width="100">å¤§å°</th>
              <th>ä¿å­˜è·¯å¾„</th>
            </tr>
          </thead>
          <tbody id="downloaded-tbody">
            <!-- JS Populated -->
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
{% endblock %}