{% extends "base.html" %}

{% block content %}
<div id="dashboard-view" class="h-full flex flex-col animate-fade-in">
  <!-- Header Section -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
    <div>
      <h1 class="text-2xl font-bold mb-1">ä»ªè¡¨ç›˜</h1>
      <p class="text-secondary opacity-70">ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ä¸ä»»åŠ¡ç›‘æ§</p>
    </div>

    <div class="flex flex-wrap gap-4 items-center">
      <!-- Global Control -->
      {% set state_str = download_state|string %}
      {% set is_running = 'Downloading' in state_str %}
      <button id="state-toggle-btn"
        class="btn {{ 'btn-danger' if is_running else 'btn-primary' }} px-6 py-3 h-auto font-medium shadow-lg hover:shadow-xl transition-all">
        <span class="flex items-center gap-2">
          <svg class="icon" viewBox="0 0 24 24" style="width:18px;height:18px;">
            {% if is_running %}
            <rect x="6" y="4" width="4" height="16"></rect>
            <rect x="14" y="4" width="4" height="16"></rect>
            {% else %}
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
            {% endif %}
          </svg>
          {{ 'æš‚åœæ‰€æœ‰' if is_running else 'å¼€å§‹æ‰€æœ‰' }}
        </span>
      </button>
    </div>
  </div>

  <!-- Tabs Navigation & Filters -->
  <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
    <!-- Left: Segmented Tabs -->
    <div class="inline-flex p-1 glass-container rounded-xl">
      <button class="tab-btn active px-6 py-2.5 rounded-lg text-sm font-medium" onclick="switchTab('active')">
        <div class="tab-btn-bg"></div>
        <div class="tab-btn-border"></div>
        <span
          class="relative z-10 flex items-center gap-2 group-[.active]:text-accent text-secondary group-hover:text-text transition-colors">
          è¿›è¡Œä¸­
          <span id="active-count" class="badge-soft badge-accent-soft">0</span>
        </span>
      </button>

      <button class="tab-btn px-6 py-2.5 rounded-lg text-sm font-medium" data-theme="neutral"
        onclick="switchTab('history')">
        <div class="tab-btn-bg"></div>
        <div class="tab-btn-border"></div>
        <span
          class="relative z-10 flex items-center gap-2 group-[.active]:text-text text-secondary group-hover:text-text transition-colors">
          å·²å®Œæˆ
          <span id="history-count" class="badge-soft badge-secondary-soft">0</span>
        </span>
      </button>
    </div>

    <!-- Right: Filters -->
    <div id="filter-toolbar"
      class="flex items-center gap-1 p-1 bg-surface/50 rounded-lg border border-transparent hover:border-border transition-colors">
      <button class="filter-chip active px-4 py-1.5 rounded-md" onclick="filterType('all')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">å…¨éƒ¨</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('video')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸ¬ è§†é¢‘</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('image')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸ–¼ï¸ å›¾ç‰‡</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('audio')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸµ éŸ³é¢‘</span>
      </button>
      <button class="filter-chip px-3 py-1.5 rounded-md" onclick="filterType('other')">
        <div class="active-bg rounded-md"></div>
        <span class="relative z-10">ğŸ“„ å…¶ä»–</span>
      </button>
    </div>
  </div>

  <!-- Task Lists Container -->
  <div class="flex-1 overflow-hidden relative rounded-xl border border-border shadow-lg bg-card/50 backdrop-blur-sm">

    <!-- Active Tasks Tab (Downloading + Uploading merged) -->
    <div id="tab-active" class="tab-content h-full flex flex-col">
      <div class="table-container flex-1 overflow-auto">
        <table class="table w-full relative">
          <thead
            class="sticky top-0 bg-surface z-10 shadow-sm text-xs uppercase tracking-wider text-secondary font-semibold">
            <tr>
              <th width="60" class="text-center">ç±»å‹</th>
              <th width="80">æ¥æºID</th>
              <th width="30%">æ–‡ä»¶å</th>
              <th width="100">å¤§å°</th>
              <th width="160">åˆ›å»ºæ—¶é—´</th>
              <th>ä¸‹è½½è¿›åº¦</th>
              <th>ä¸Šä¼ è¿›åº¦</th>
              <th width="100">é€Ÿåº¦</th>
              <th width="120" class="text-right px-4">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="active-tbody">
            <!-- JS Populated -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- History Tab -->
    <div id="tab-history" class="tab-content hidden h-full flex flex-col">
      <!-- Header with Clear Button -->
      <div class="flex justify-end p-2 border-b border-border/30">
        <button id="clear-history-btn" onclick="clearHistory()"
          class="btn btn-outline text-xs px-3 py-1.5 flex items-center gap-1.5 hover:bg-danger/10 hover:text-danger hover:border-danger transition-colors">
          <svg class="icon" style="width:14px;height:14px;" viewBox="0 0 24 24">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          æ¸…ç©ºå†å²
        </button>
      </div>
      <div class="table-container flex-1 overflow-auto">
        <table class="table w-full relative">
          <thead
            class="sticky top-0 bg-surface z-10 shadow-sm text-xs uppercase tracking-wider text-secondary font-semibold">
            <tr>
              <th width="60" class="text-center">ç±»å‹</th>
              <th width="80">ID</th>
              <th width="30%">æ–‡ä»¶å</th>
              <th width="100">å¤§å°</th>
              <th width="140">å®Œæˆæ—¶é—´</th>
              <th>è¿œç¨‹è·¯å¾„</th>
              <th width="60" class="text-center">æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="downloaded-tbody">
            <!-- JS Populated -->
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>
{% endblock %}